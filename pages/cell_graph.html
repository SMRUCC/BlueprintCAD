<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Quick Sigma.js Example</title>
    <script src="./js/sigma.min.js"></script>
    <script src="./js/graphology.umd.min.js"></script>
    <script src="./js/graphology-library.min.js"></script>
</head>

<body style="background: lightgrey">
    <div id="container" style="width: 1600px; height: 1200px; background: white"></div>
    <script>
        // 这是处理数据的JS函数
        function processLargeData(data) {
            // Create a graphology graph
            const graph = new graphology.Graph();

            console.log("成功接收到数据:", data);
            console.log("成功接收 " + data.length + " 条数据!");

            for (let node of data.nodes) {
                graph.addNode(node.id, node);
            }
            for (let edge of data.edges) {
                graph.addEdge(edge.source, edge.target, edge);
            }

            // Instantiate sigma.js and render the graph
            const sigma_graph = new Sigma(graph, document.getElementById("container"));
            // Graphology provides a easy to use implementation of Force Atlas 2 in a web worker
            const sensibleSettings = graphologyLibrary.layoutForceAtlas2.inferSettings(graph);
            const fa2Layout = new graphologyLibrary.FA2Layout(graph, {
                settings: sensibleSettings,
            });

            fa2Layout.start();
        }

        // 关键步骤：添加消息事件监听器
        window.addEventListener('DOMContentLoaded', () => {
            // 'message' 事件是 WebView2 通信的核心
            window.chrome.webview.addEventListener('message', event => {
                // event.data 就是 VB.NET 发送过来的、已经反序列化好的 JavaScript 对象
                console.log("收到 message 事件:", event);
                processLargeData(event.data);
            });
        });
    </script>
</body>

</html>